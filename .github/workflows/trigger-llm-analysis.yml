name: Trigger LLM Analysis

on:
  workflow_dispatch:
    inputs:
      state:
        type: choice
        description: "State to analyze"
        options:
          - wy
          - all
        default: "wy"
      analyze-versions:
        type: boolean
        description: "Analyze bill versions and track changes"
        default: true
      generate-reports:
        type: boolean
        description: "Generate human-readable reports"
        default: true

jobs:
  trigger-llm-analysis:
    name: Trigger LLM Analysis in Main Repo
    runs-on: ubuntu-latest

    steps:
      - name: Trigger LLM Analysis Workflow
        uses: actions/github-script@v7
        with:
          script: |
            const workflow_id = 'llm-bill-analysis.yml';
            const ref = 'llm-bill-tracker'; // or 'main' depending on which branch has the workflow

            try {
              const response = await github.rest.actions.createWorkflowDispatch({
                owner: 'windy-civi',
                repo: 'opencivicdata-blockchain-transformer',
                workflow_id: workflow_id,
                ref: ref,
                inputs: {
                  state: '${{ inputs.state }}',
                  'analyze-versions': '${{ inputs.analyze-versions }}',
                  'generate-reports': '${{ inputs.generate-reports }}'
                }
              });

              console.log('✅ Successfully triggered LLM analysis workflow');
              console.log('📊 Check the main repository for results');

            } catch (error) {
              console.error('❌ Failed to trigger workflow:', error.message);
              core.setFailed('Failed to trigger LLM analysis workflow');
            }

      - name: Provide Instructions
        run: |
          echo "🤖 LLM Analysis Workflow Triggered!"
          echo "=================================="
          echo ""
          echo "📊 The LLM analysis has been triggered in the main repository."
          echo "📄 You can monitor progress at:"
          echo "   https://github.com/windy-civi/opencivicdata-blockchain-transformer/actions"
          echo ""
          echo "📋 Parameters used:"
          echo "   - State: ${{ inputs.state }}"
          echo "   - Analyze versions: ${{ inputs.analyze-versions }}"
          echo "   - Generate reports: ${{ inputs.generate-reports }}"
          echo ""
          echo "💡 Results will be available as artifacts in the main repository."
